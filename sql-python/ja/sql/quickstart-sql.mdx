---
title: 'クイックスタート - SQL'
---

以下のようにSQLの中にjinjaで設定値を書くことができます。

```sql
{{
	config(
		name="test",
		description="this is test sql statement",
		output_paths=[
			"_private/{name}/{now()}{ext()}"
		],
		connection="your_connection_slug"
	)
}}

select 1 as test
```

**Configの設定値**

| カラム | 説明 |
| --- | --- |
| name | 処理名, 他のファイルから呼び出す時のエイリアスとしても使える |
| description | 処理の説明を残す |
| output_paths | 結果ファイルの出力先 |
| connection | 画面で登録したbuiltin以外のconnectionの向き先 (optional)
※ 指定をしない場合はbuilt-in postgresqlに設定されます。 |

**Jinja**

リンク: [https://jinja.palletsprojects.com/en/2.10.x/templates/#synopsis](https://jinja.palletsprojects.com/en/2.10.x/templates/#synopsis)

Jinjaを使用することでSQL内にplaceholderやif文などの条件分岐を記述することができます。

基本的な文法のif、variables以外のものは上記のリンクから参照できます。

`if` & `variables`

Jinjaの記法でif文を記述します。また`{{ }}`で囲うとvariablesとみなされrunした際の引数がここに入るようになっています。

`morph run user -d user_type=admin`

-dでvariablesを指定することができます。

```sql
{{
	config(
		name="user",
		description="User",
		output_paths=[
			"_private/{name}/{now()}{ext()}"
		]
	)
}}

{% if user_type %}
# user_typeが送られたときに発行されるSQL
# 通常のSQLと同様に指定の値はシングルクオートで囲む必要あり(dbの文法による)
select * from user where user_type = '{{ user_type }}'
{% else %}
# user_typeの指定がないときに発行されるSQL
select * from user
{% endif %}
```

morph独自のJinja関数であるload_dataの使い方

`load_data(”参照する他のcell名”)`

load_data関数を使用することで他のcellの結果をテーブルのように扱うことができます。

以下のように記述した場合`user_cache` のcellを実行したあとの結果ファイルをテーブルとしてアクセスすることができます。

※ 参照するcellの結果ファイルはcsvである必要があるため注意してください

```sql
{{
	config(
		name="user",
		description="User",
		output_paths=[
			"_private/{name}/{now()}{ext()}"
		]
	)
}}

select
	*
from
	{{ load_data("user_cache") }}
```

<Warning>SQLではstatementの最後にセミコロンをつけることが一般的ですが、一つのファイルに複数のSQLを書かれることを防止するためにセミコロンの使用を禁止しています。</Warning>